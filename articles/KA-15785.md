---
title: Campaign Classic V7 - Optimize SQL query generated in Database update wizard
description: Description
solution: Campaign,Campaign Classic v7
product: Campaign,Campaign Classic v7
applies-to: Campaign Classic,Campaign,Campaign Classic v7
keywords: KCS
resolution: Resolution
internal-notes: It can be helpful when dealing with database update issues with big tables
bug: true
article-created-by: Marta Zator
article-created-date: 5/5/2022 10:16:35 AM
article-published-by: Marta Zator
article-published-date: 5/5/2022 10:18:58 AM
version-number: 2
article-number: KA-15785
dynamics-url: https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=e810bb6a-5ccc-ec11-a7b5-6045bd00dbbc
exl-id: 73e8701c-88e5-4b73-8c55-90eaee26d2ac
---
# Campaign Classic V7 - Optimize SQL query generated in Database update wizard

## Description


<b>Background and context :</b>
 In most of the Campaign builds including Gold Standard 9032 ones, we might encounter multiple issues when adding new columns to an existing schema.

 The scope of this article is to address one specific problem which is related to :

- Adding an integer field to an existing schema when records already exists.
- Optimize the SQL query generated by the application to an Efficient one for Postgres SQL.


<b>Use case :</b> 
<br>We have an existing recipient table or any other table which already has in excess of 1 million records.
<br>We now need to add one extra column to that table which is of data type integer.
<br>We add that column in the schema definition and we want to commit the changes in the database.

<b>Challenge </b>:
<br>We encounter and issue while updating the database and the Database encounters a deadlock or the query blocks other operations.
<br>This is mainly due to updating of all records to 0 based on the SQL command generated by the database wizard.


<br> <br>

## Resolution


Solution :

When adding an integer column , we get the SQL statement generated like this :

<b>ALTER TABLE NmsRecipient ADD column_name SMALLINT;
<br>UPDATE NmsRecipient SET column_name = 0;
<br>ALTER TABLE NmsRecipient ALTER COLUMN column_name SET Default 0;
<br>ALTER TABLE NmsRecipient ALTER COLUMN icolumn_name SET NOT NULL;</b>

The problem here is that there are 4 commands executed in the database in parallel which can cause performance issues or a deadlock.

The solution is to condense these 4 commands into one and still do the same changes as below :

<b>ALTER TABLE NmsRecipient ADD iFichierLiveDataCliqueurs SMALLINT NOT NULL SET Default 0 ;</b>

It does all the changes required, adding the column, setting the default, set NOT NULL, and also setting the value of existing records to 0 because of the NOT NULL constraint.



<b>NOTE :</b>

If there are multiple integer columns that need to be added, add them one by one and run the database wizard for each change.

This is to ensure smooth operation since the statement updates all <b>existing </b>records to 0 as well and depending on the no. of records it can take time.
